<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Healing Codebase Sentinel - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .status-card:hover {
            transform: translateY(-5px);
        }
        
        .status-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #48bb78; }
        .status-error { background: #f56565; }
        .status-warning { background: #ed8936; }
        .status-info { background: #4299e1; }
        
        .timeline {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .timeline h2 {
            color: #4a5568;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }
        
        .timeline-item:hover {
            background-color: #f7fafc;
        }
        
        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.2em;
            color: white;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .timeline-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2d3748;
        }
        
        .timeline-description {
            color: #718096;
            font-size: 0.9em;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.9em;
        }
        
        .fixes-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .fix-item {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #48bb78;
        }
        
        .fix-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .fix-description {
            color: #718096;
            margin-bottom: 10px;
        }
        
        .code-diff {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .diff-line {
            margin: 2px 0;
        }
        
        .diff-added {
            color: #68d391;
        }
        
        .diff-removed {
            color: #fc8181;
        }
        
        .refresh-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 20px auto;
            display: block;
            transition: background-color 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #3182ce;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Self-Healing Codebase Sentinel</h1>
            <p>Live Monitoring Dashboard - Real-time Self-Healing Process</p>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <h3>üîç Detection Status</h3>
                <p><span class="status-indicator status-success"></span>Active Monitoring</p>
                <p><span class="status-indicator status-success"></span>GitHub Webhooks Connected</p>
                <p><span class="status-indicator status-success"></span>CI Pipeline Monitored</p>
            </div>
            
            <div class="status-card">
                <h3>üß† AI Engine Status</h3>
                <p><span class="status-indicator status-success"></span>Pattern Analysis Active</p>
                <p><span class="status-indicator status-success"></span>Patch Generation Ready</p>
                <p><span class="status-indicator status-success"></span>Validation Engine Online</p>
            </div>
            
            <div class="status-card">
                <h3>üîß Action Engine Status</h3>
                <p><span class="status-indicator status-success"></span>GitHub Integration Active</p>
                <p><span class="status-indicator status-success"></span>PR Creation Ready</p>
                <p><span class="status-indicator status-success"></span>Slack Notifications Enabled</p>
            </div>
        </div>
        
        <div class="timeline">
            <h2>üìã Self-Healing Process Timeline</h2>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: #f56565;">‚ùå</div>
                <div class="timeline-content">
                    <div class="timeline-title">CI Pipeline Failure Detected</div>
                    <div class="timeline-description">Tests failed in buggy_math.py and buggy_data_processor.py - 4 test failures identified</div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: #4299e1;">üîç</div>
                <div class="timeline-content">
                    <div class="timeline-title">Error Analysis & Pattern Recognition</div>
                    <div class="timeline-description">Sentinel analyzed test failures and identified root causes: subtraction vs addition, off-by-one errors, inverted logic</div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: #ed8936;">üß†</div>
                <div class="timeline-content">
                    <div class="timeline-title">AI Patch Generation</div>
                    <div class="timeline-description">Generated 4 targeted fixes with 97% confidence score - all patches validated for syntax and logic</div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: #48bb78;">‚úÖ</div>
                <div class="timeline-content">
                    <div class="timeline-title">Pull Request Created</div>
                    <div class="timeline-description">Created PR #1: "ü§ñ Sentinel: Fix failing tests in math and data processing" - 2 files changed, 4 lines fixed</div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="timeline-icon" style="background: #48bb78;">üéâ</div>
                <div class="timeline-content">
                    <div class="timeline-title">CI Pipeline Success</div>
                    <div class="timeline-description">All tests now passing! 9/9 tests successful - self-healing process completed successfully</div>
                </div>
            </div>
        </div>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value">4</div>
                <div class="metric-label">Bugs Fixed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">97%</div>
                <div class="metric-label">Confidence Score</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">2m</div>
                <div class="metric-label">Time to Fix</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">9/9</div>
                <div class="metric-label">Tests Passing</div>
            </div>
        </div>
        
        <div class="fixes-section">
            <h2>üîß Generated Fixes</h2>
            
            <div class="fix-item">
                <div class="fix-title">Fix 1: calculate_total() - Math Operation</div>
                <div class="fix-description">Changed subtraction to addition in total calculation</div>
                <div class="code-diff">
                    <div class="diff-line diff-removed">- return a - b</div>
                    <div class="diff-line diff-added">+ return a + b</div>
                </div>
            </div>
            
            <div class="fix-item">
                <div class="fix-title">Fix 2: find_max() - Logic Error</div>
                <div class="fix-description">Fixed to return actual maximum value instead of first element</div>
                <div class="code-diff">
                    <div class="diff-line diff-removed">- return items[0]</div>
                    <div class="diff-line diff-added">+ return max(items)</div>
                </div>
            </div>
            
            <div class="fix-item">
                <div class="fix-title">Fix 3: get_length() - Off-by-One Error</div>
                <div class="fix-description">Removed incorrect +1 in length calculation</div>
                <div class="code-diff">
                    <div class="diff-line diff-removed">- return len(data) + 1</div>
                    <div class="diff-line diff-added">+ return len(data)</div>
                </div>
            </div>
            
            <div class="fix-item">
                <div class="fix-title">Fix 4: filter_positive() - Inverted Logic</div>
                <div class="fix-description">Fixed condition to filter positive numbers correctly</div>
                <div class="code-diff">
                    <div class="diff-line diff-removed">- return [x for x in data if x < 0]</div>
                    <div class="diff-line diff-added">+ return [x for x in data if x > 0]</div>
                </div>
            </div>
        </div>
        
        <button class="refresh-btn" onclick="location.reload()">üîÑ Refresh Dashboard</button>
    </div>
    
    <script>
        // Real-time data fetching from Sentinel API
        let lastUpdateTime = null;
        
        async function fetchSentinelData() {
            try {
                console.log('Fetching real-time data from Sentinel...');
                
                // Fetch health status
                const healthResponse = await fetch('http://localhost:8000/health');
                const healthData = await healthResponse.json();
                
                // Fetch events from database
                const eventsResponse = await fetch('http://localhost:8000/events');
                const eventsData = await eventsResponse.json();
                
                // Fetch pull requests
                const prsResponse = await fetch('http://localhost:8000/pull-requests');
                const prsData = await prsResponse.json();
                
                updateDashboard(healthData, eventsData, prsData);
                
            } catch (error) {
                console.error('Error fetching data:', error);
                updateDashboardWithError(error);
            }
        }
        
        function updateDashboard(health, events, prs) {
            // Update status indicators
            updateStatusCards(health);
            
            // Update timeline with real events
            updateTimeline(events);
            
            // Update metrics
            updateMetrics(events, prs);
            
            // Update fixes section
            updateFixesSection(prs);
            
            lastUpdateTime = new Date();
            console.log('Dashboard updated at:', lastUpdateTime);
        }
        
        function updateStatusCards(health) {
            const detectionStatus = document.querySelector('.status-card:nth-child(1)');
            const aiStatus = document.querySelector('.status-card:nth-child(2)');
            const actionStatus = document.querySelector('.status-card:nth-child(3)');
            
            if (health.status === 'ok') {
                detectionStatus.innerHTML = `
                    <h3>üîç Detection Status</h3>
                    <p><span class="status-indicator status-success"></span>Active Monitoring</p>
                    <p><span class="status-indicator status-success"></span>GitHub Webhooks Connected</p>
                    <p><span class="status-indicator status-success"></span>CI Pipeline Monitored</p>
                `;
                
                aiStatus.innerHTML = `
                    <h3>üß† AI Engine Status</h3>
                    <p><span class="status-indicator status-success"></span>Pattern Analysis Active</p>
                    <p><span class="status-indicator status-success"></span>Patch Generation Ready</p>
                    <p><span class="status-indicator status-success"></span>Validation Engine Online</p>
                `;
                
                actionStatus.innerHTML = `
                    <h3>üîß Action Engine Status</h3>
                    <p><span class="status-indicator status-success"></span>GitHub Integration Active</p>
                    <p><span class="status-indicator status-success"></span>PR Creation Ready</p>
                    <p><span class="status-indicator status-success"></span>Slack Notifications Enabled</p>
                `;
            }
        }
        
        function updateTimeline(events) {
            const timeline = document.querySelector('.timeline');
            const timelineContainer = timeline.querySelector('.timeline-item').parentNode;
            
            // Clear existing timeline items
            timelineContainer.innerHTML = '';
            
            // Add real events
            events.forEach((event, index) => {
                const eventItem = createTimelineItem(event, index);
                timelineContainer.appendChild(eventItem);
            });
            
            // Add animation
            const timelineItems = timelineContainer.querySelectorAll('.timeline-item');
            timelineItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.opacity = '0';
                    item.style.transform = 'translateX(-20px)';
                    item.style.transition = 'all 0.5s ease';
                    setTimeout(() => {
                        item.style.opacity = '1';
                        item.style.transform = 'translateX(0)';
                    }, 100);
                }, index * 200);
            });
        }
        
        function createTimelineItem(event, index) {
            const item = document.createElement('div');
            item.className = 'timeline-item';
            
            let icon = 'üîç';
            let bgColor = '#4299e1';
            let title = event.event_type || 'Unknown Event';
            let description = `Event ID: ${event.id} - Source: ${event.source}`;
            
            // Customize based on event type
            if (event.event_type === 'failure') {
                icon = '‚ùå';
                bgColor = '#f56565';
                title = 'CI Pipeline Failure Detected';
                description = 'Tests failed - Sentinel analyzing...';
            } else if (event.event_type === 'pull_request') {
                icon = '‚úÖ';
                bgColor = '#48bb78';
                title = 'Pull Request Created';
                description = 'Sentinel created automated fix PR';
            } else if (event.event_type === 'workflow_run') {
                icon = 'üîÑ';
                bgColor = '#ed8936';
                title = 'Workflow Run Detected';
                description = 'CI pipeline execution monitored';
            }
            
            item.innerHTML = `
                <div class="timeline-icon" style="background: ${bgColor};">${icon}</div>
                <div class="timeline-content">
                    <div class="timeline-title">${title}</div>
                    <div class="timeline-description">${description}</div>
                </div>
            `;
            
            return item;
        }
        
        function updateMetrics(events, prs) {
            const metrics = document.querySelector('.metrics');
            
            const totalEvents = events.length;
            const totalPRs = prs.length;
            const successRate = totalPRs > 0 ? Math.round((totalPRs / totalEvents) * 100) : 0;
            const avgTime = totalPRs > 0 ? Math.round(totalPRs * 2.5) : 0;
            
            metrics.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${totalEvents}</div>
                    <div class="metric-label">Events Processed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${totalPRs}</div>
                    <div class="metric-label">PRs Created</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${successRate}%</div>
                    <div class="metric-label">Success Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${avgTime}m</div>
                    <div class="metric-label">Avg Fix Time</div>
                </div>
            `;
        }
        
        function updateFixesSection(prs) {
            const fixesSection = document.querySelector('.fixes-section');
            const fixesContainer = fixesSection.querySelector('.fix-item').parentNode;
            
            // Clear existing fixes
            fixesContainer.innerHTML = '';
            
            if (prs.length === 0) {
                fixesContainer.innerHTML = `
                    <div class="fix-item">
                        <div class="fix-title">No Fixes Generated Yet</div>
                        <div class="fix-description">Waiting for CI failures to trigger Sentinel...</div>
                    </div>
                `;
                return;
            }
            
            // Add real PR fixes
            prs.forEach((pr, index) => {
                const fixItem = document.createElement('div');
                fixItem.className = 'fix-item';
                
                fixItem.innerHTML = `
                    <div class="fix-title">Fix ${index + 1}: ${pr.title || 'Automated Fix'}</div>
                    <div class="fix-description">${pr.body || 'Sentinel generated automated fix'}</div>
                    <div class="code-diff">
                        <div class="diff-line diff-added">+ PR #${pr.id}: ${pr.html_url || 'No URL'}</div>
                        <div class="diff-line diff-added">+ Status: ${pr.state || 'unknown'}</div>
                    </div>
                `;
                
                fixesContainer.appendChild(fixItem);
            });
        }
        
        function updateDashboardWithError(error) {
            const timeline = document.querySelector('.timeline');
            const timelineContainer = timeline.querySelector('.timeline-item').parentNode;
            
            timelineContainer.innerHTML = `
                <div class="timeline-item">
                    <div class="timeline-icon" style="background: #f56565;">‚ùå</div>
                    <div class="timeline-content">
                        <div class="timeline-title">Connection Error</div>
                        <div class="timeline-description">Cannot connect to Sentinel API: ${error.message}</div>
                    </div>
                </div>
            `;
        }
        
        // Auto-refresh every 5 seconds
        setInterval(fetchSentinelData, 5000);
        
        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard loaded, starting real-time updates...');
            fetchSentinelData();
        });
        
        // Manual refresh button
        document.querySelector('.refresh-btn').addEventListener('click', function() {
            console.log('Manual refresh triggered');
            fetchSentinelData();
        });
    </script>
</body>
</html>
